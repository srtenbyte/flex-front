{
  "version": 3,
  "sources": ["../../@csvbox/react/src/index.js"],
  "sourcesContent": ["import React, { Component } from 'react';\n// import styles from './styles.module.css'\nimport { version } from '../package.json';\n\nexport class CSVBoxButton extends Component {\n\n  constructor(props) {\n    super(props)\n    this.holder = React.createRef();\n    this.openModal = this.openModal.bind(this)\n    this.isModalShown = false;\n    this.shouldOpenModalOnReady = false;\n    this.uuid = this.generateUuid();\n    this.state = {\n      isLoading: true\n    };\n    this.iframe = null;\n  }\n\n  componentDidMount() {\n    const { lazy } = this.props;\n    if(!lazy && !this.iframe) {\n      this.initImporter();\n    }else if(lazy) {\n      this.enableInitator();\n    }\n  }\n\n  initImporter() {\n\n    const { loadStarted } = this.props;\n\n    loadStarted?.();\n\n    const { user } = this.props;\n    const { dynamicColumns } = this.props;\n    const { options } = this.props;\n    const { onReady } = this.props;\n    const { onImport } = this.props;\n    const { onSubmit } = this.props;\n    const { onClose } = this.props;\n    const { licenseKey } = this.props;\n    const { dataLocation } = this.props;\n    const { customDomain } = this.props;\n    const { language } = this.props;\n    const { environment } = this.props;\n    const { theme } = this.props;\n\n    let domain = customDomain ? customDomain : \"app.csvbox.io\";\n\n    if(dataLocation) {\n      domain = `${dataLocation}-${domain}`;\n    }\n\n    let iframeUrl = `https://${domain}/embed/${licenseKey}`;\n\n    iframeUrl += `?library-version=${version}`;\n    iframeUrl += \"&framework=react\";\n\n    if(dataLocation) {\n      iframeUrl += \"&preventRedirect\";\n    }\n\n    if(language) {\n      iframeUrl += \"&language=\" + language;\n    }\n\n    if(theme) {\n      iframeUrl += \"&theme=\" + theme;\n    }\n\n    if(environment) {\n      let env = JSON.stringify(environment).replace(/['\"]/g, function(match) {\n        return '\\\\' + match;\n      });\n      iframeUrl += `&env=${env}`;\n    }\n\n    window.addEventListener(\"message\", (event) => {\n\n      if (event.data === \"mainModalHidden\") {\n        if (this.holder && this.holder.current) {\n          this.holder.current.style.display = 'none';\n        };\n        this.isModalShown = false;\n        onClose?.();\n      }\n      if(event.data === \"uploadSuccessful\") {\n        onImport(true);\n      }\n      if(event.data === \"uploadFailed\") {\n        onImport(false);\n      }\n      if(typeof event.data == \"object\") {\n\n        if(event?.data?.data?.unique_token == this.uuid) {\n\n          if(event.data.type && event.data.type == \"data-on-submit\") {\n            let metadata = event.data.data;\n            metadata[\"column_mappings\"] = event.data.column_mapping;\n            delete metadata[\"unique_token\"];\n            onSubmit?.(metadata);\n          }\n          else if(event.data.type && event.data.type == \"data-push-status\") {\n            if(event.data.data.import_status == \"success\") {\n              if(event.data && event.data.row_data) {\n                let primary_row_data = event.data.row_data;\n                let headers = event.data.headers;\n                let rows = [];\n                let dynamic_columns_indexes = event.data.dynamicColumnsIndexes;\n                let virtual_columns_indexes = event.data.virtualColumnsIndexes || [];\n\n                let dropdown_display_labels_mappings = event.data.dropdown_display_labels_mappings;\n                primary_row_data.forEach((row_data) => {\n                    let x = {};\n                    let dynamic_columns = {};\n                    let virtual_data = {};\n                    row_data.data?.forEach((col, i) => {\n                        if(col == undefined){ col = \"\" }\n                        if(!!dropdown_display_labels_mappings[i] && !!dropdown_display_labels_mappings[i][col]) {\n                            col = dropdown_display_labels_mappings[i][col];\n                        }\n                        if(dynamic_columns_indexes.includes(i)) {\n                          dynamic_columns[headers[i]] = col;\n                        }\n                        else if(virtual_columns_indexes.includes(i)) {\n                          virtual_data[headers[i]] = col;\n                        }\n                        else{\n                            x[headers[i]] = col;\n                        }\n                    });\n                    if(row_data.unmapped_data) {\n                      x[\"_unmapped_data\"] = row_data.unmapped_data;\n                    }\n                    if(dynamic_columns && Object.keys(dynamic_columns).length > 0) {\n                      x[\"_dynamic_data\"] = dynamic_columns;\n                    }\n                    if(virtual_data && Object.keys(virtual_data).length > 0) {\n                      x[\"_virtual_data\"] = virtual_data;\n                    }\n                    rows.push(x);\n                });\n                let metadata = event.data.data;\n                metadata[\"rows\"] = rows;\n                metadata[\"column_mappings\"] = event.data.column_mapping;\n                metadata[\"raw_columns\"] = event.data.raw_columns;\n                metadata[\"ignored_columns\"] = event.data.ignored_column_row;\n                delete metadata[\"unique_token\"];\n                onImport(true, metadata);\n              }else{\n                let metadata = event.data.data;\n                delete metadata[\"unique_token\"];\n                onImport(true, metadata);\n              }\n            }else {\n              onImport(false, event.data.data);\n            }\n          } else if(event.data.type && event.data.type == \"csvbox-modal-hidden\") {\n            if (this.holder && this.holder.current) {\n              this.holder.current.style.display = 'none';\n            };\n            this.isModalShown = false;\n            onClose?.();\n          } else if(event.data.type && event.data.type == \"csvbox-upload-successful\") {\n            this.onImport?.(true);\n          } else if(event.data.type && event.data.type == \"csvbox-upload-failed\") {\n            this.onImport?.(false);\n          }\n        }\n      }\n    }, false);\n\n    let self = this;\n\n    let iframe = document.createElement(\"iframe\");\n    this.iframe = iframe;\n    iframe.setAttribute(\"src\", iframeUrl);\n    iframe.frameBorder = 0;\n    iframe.classList.add('csvbox-iframe');\n\n    iframe.style.height = \"100%\";\n    iframe.style.width = \"100%\";\n    iframe.style.position = \"absolute\";\n    iframe.style.top = \"0px\";\n    iframe.style.left = \"0px\";\n\n    window.addEventListener(\"message\", this.onMessageEvent, false);\n\n    iframe.onload = function () {\n      self.enableInitator();\n      iframe.contentWindow.postMessage({\n        \"customer\" : user ? user : null,\n        \"columns\" : dynamicColumns ? dynamicColumns : null,\n        \"options\" : options ? options : null,\n        \"unique_token\": self.uuid\n      }, \"*\");\n      onReady?.();\n      if(self.shouldOpenModalOnReady) {\n        self.openModal();\n        self.shouldOpenModalOnReady = false;\n      }\n    }\n    this.holder.current.appendChild(iframe);\n  }\n\n  openModal() {\n\n    const { lazy } = this.props;\n\n    if(lazy) {\n      if(!this.iframe) {\n          this.shouldOpenModalOnReady = true;\n          this.initImporter();\n          return;\n      }\n    }\n\n    if(!this.isModalShown) {\n      if(!this.state.isLoading) {\n        this.isModalShown = true;\n        this.iframe.contentWindow.postMessage('openModal', '*');\n        this.holder.current.style.display = 'block';\n      } else {\n        this.shouldOpenModalOnReady = true;\n      }\n    }\n\n  }\n\n  generateUuid() {\n    return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n  }\n\n  enableInitator() {\n    this.setState({\n      isLoading: false\n    })\n  }\n\n  render() {\n\n    const holderStyle = {\n      display: \"none\",\n      zIndex: 2147483647,\n      position: \"fixed\",\n      top: 0,\n      bottom: 0,\n      left: 0,\n      right: 0\n    };\n\n    if(this.props.render) {\n      return (\n        <div>\n          {this.props.render(this.openModal, this.state.isLoading)}\n          <div ref={this.holder} style={holderStyle}></div>\n        </div>\n      )\n    }else{\n      return (\n        <div>\n          <button disabled={this.state.isLoading} onClick={this.openModal} data-csvbox-initator data-csvbox-token={this.uuid}>{this.props.children}</button>\n          <div ref={this.holder} style={holderStyle}></div>\n        </div>\n      )\n    }\n\n\n  }\n}\n\nexport default CSVBoxButton;\n"],
  "mappings": "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",
  "names": ["CSVBoxButton", "props", "holder", "React", "createRef", "openModal", "bind", "isModalShown", "shouldOpenModalOnReady", "uuid", "generateUuid", "state", "isLoading", "iframe", "componentDidMount", "lazy", "initImporter", "enableInitator", "loadStarted", "user", "dynamicColumns", "options", "onReady", "onImport", "onSubmit", "onClose", "licenseKey", "dataLocation", "customDomain", "language", "environment", "theme", "domain", "iframeUrl", "version", "env", "JSON", "stringify", "replace", "match", "window", "addEventListener", "event", "data", "current", "style", "display", "unique_token", "type", "metadata", "column_mapping", "import_status", "row_data", "primary_row_data", "headers", "rows", "dynamic_columns_indexes", "dynamicColumnsIndexes", "virtual_columns_indexes", "virtualColumnsIndexes", "dropdown_display_labels_mappings", "forEach", "x", "dynamic_columns", "virtual_data", "col", "i", "undefined", "includes", "unmapped_data", "Object", "keys", "length", "push", "raw_columns", "ignored_column_row", "self", "document", "createElement", "setAttribute", "frameBorder", "classList", "add", "height", "width", "position", "top", "left", "onMessageEvent", "onload", "contentWindow", "postMessage", "appendChild", "Math", "random", "toString", "substring", "setState", "render", "holderStyle", "zIndex", "bottom", "right", "children", "Component"]
}
